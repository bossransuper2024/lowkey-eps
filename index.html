<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Korean EPS Vocabulary Mastering</title>
<style>
body { font-family: Arial, sans-serif; background:#111; color:#fff; text-align:center; }
.container { max-width:800px; margin:auto; padding:20px; }
button { padding:10px 20px; margin:5px; border:none; border-radius:8px; cursor:pointer; }
.menu-btn { background:#1f1f1f; color:#fff; }
.category-btn { background:#2d2d2d; color:#fff; }
.card { margin-top:40px; font-size:48px; font-weight:bold; cursor:pointer; user-select:none; }
.sub { font-size:24px; margin-top:20px; color:#00ffcc; }
.hidden { display:none; }
.error { color:#ff4d4d; margin-top:15px; }
.back-btn { background:#333; color:#fff; }
#tapInfo { cursor:pointer; font-size:20px; color:#0ff; margin-top:15px; }
</style>
</head>
<body>
<div class="container">
<h1>Korean EPS Vocabulary Mastering  / lenz supot</h1>

<!-- MODE MENU -->
<div id="modeMenu">
<h2>Select Mode</h2>
<button class="menu-btn" onclick="setMode(1)">1️⃣ Hangul → Reveal</button>
<button class="menu-btn" onclick="setMode(2)">2️⃣ Hangul + Reveal Auto</button>
</div>

<!-- CATEGORY MENU -->
<div id="categoryMenu" class="hidden">
<h2>Select Category</h2>
<div id="categories"></div>
<div id="errorMsg" class="error"></div>
<button class="back-btn" onclick="backToMode()">⬅️ Back to Mode</button>
</div>

<!-- FLASHCARD AREA -->
<div id="flashcard" class="hidden">
<h2 id="categoryTitle"></h2>
<div class="card" id="hangul"></div>
<div class="sub hidden" id="romanization"></div>
<div class="sub hidden" id="meaning"></div>
<div id="tapInfo" class="sub">Tap here to reveal</div>
<br>
<button onclick="nextWord()">Next</button>
<button class="back-btn" onclick="backToMode()">⬅️ Back to Mode</button>
</div>
</div>

<script>
let vocabData = {};
let currentCategory = "";
let currentIndex = 0;
let mode = 1;

// Fallback data
vocabData = {
  "Work": [
    { "hangul": "일", "romanization": "il", "meaning": "work" },
    { "hangul": "회사", "romanization": "hoesa", "meaning": "company" }
  ],
  "Food": [
    { "hangul": "밥", "romanization": "bap", "meaning": "rice / meal" },
    { "hangul": "물", "romanization": "mul", "meaning": "water" }
  ]
};

// GitHub Pages fetch with cache-busting
fetch('./vocab.json?timestamp=' + new Date().getTime())
  .then(res => res.json())
  .then(data => {
      vocabData = data;
      console.log("Loaded vocab.json from GitHub Pages", vocabData);
  })
  .catch(err => {
      console.log("Failed to load vocab.json, using fallback data", err);
  });

function setMode(selectedMode){
    mode = selectedMode;
    document.getElementById('modeMenu').classList.add('hidden');
    document.getElementById('categoryMenu').classList.remove('hidden');
    loadCategories();
}

function backToMode(){
    document.getElementById('flashcard').classList.add('hidden');
    document.getElementById('categoryMenu').classList.add('hidden');
    document.getElementById('modeMenu').classList.remove('hidden');
}

function loadCategories(){
    let catDiv = document.getElementById('categories');
    let errorDiv = document.getElementById('errorMsg');
    catDiv.innerHTML = "";
    if(Object.keys(vocabData).length === 0){
        errorDiv.innerText = "No categories found. Check vocab.json file.";
        return;
    }
    for(let category in vocabData){
        let btn = document.createElement('button');
        btn.className = 'category-btn';
        btn.innerText = category;
        btn.onclick = () => selectCategory(category);
        catDiv.appendChild(btn);
    }
}

function selectCategory(category){
    currentCategory = category;
    currentIndex = 0;
    document.getElementById('categoryMenu').classList.add('hidden');
    document.getElementById('flashcard').classList.remove('hidden');
    document.getElementById('categoryTitle').innerText = category;
    showWord();
}

function showWord(){
    let word = vocabData[currentCategory][currentIndex];
    document.getElementById('hangul').innerText = word.hangul;
    document.getElementById('romanization').innerText = word.romanization;
    document.getElementById('meaning').innerText = word.meaning;
    document.getElementById('romanization').classList.add('hidden');
    document.getElementById('meaning').classList.add('hidden');
    document.getElementById('tapInfo').style.display = mode === 1 ? 'block' : 'none';

    if(mode === 2){
        reveal();
    }
}

function reveal(){
    document.getElementById('romanization').classList.remove('hidden');
    document.getElementById('meaning').classList.remove('hidden');
    document.getElementById('tapInfo').style.display = 'none';
}

function nextWord(){
    currentIndex++;
    if(currentIndex >= vocabData[currentCategory].length){
        currentIndex = 0;
    }
    showWord();
}

// SPACEBAR REVEAL
document.addEventListener('keydown', function(e){
    if(e.code === 'Space'){
        e.preventDefault();
        reveal();
    }
});

// TAP ON CARD TO REVEAL
document.getElementById('hangul').addEventListener('click', function(){
    if(mode === 1){
        reveal();
    }
});
</script>
</body>
</html>
