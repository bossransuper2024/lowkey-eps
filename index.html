<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Korean EPS Vocabulary Mastering</title>
<style>
/* BODY & CONTAINER */
body { font-family: Arial, sans-serif; background:#111; color:#fff; text-align:center; margin:0; }
.container { max-width:800px; width:95%; margin:auto; padding:20px; }

/* BUTTONS */
button { padding:10px 15px; margin:5px; border:none; border-radius:8px; cursor:pointer; font-size:16px; }
.menu-btn { background:#1f1f1f; color:#fff; }
.category-btn { background:#2d2d2d; color:#fff; }
.back-btn { background:#333; color:#fff; }

/* FLEX CENTER FOR BACK + RANDOM */
.flex-center { display:flex; justify-content:center; align-items:center; gap:10px; margin:10px 0; }

/* FLASHCARD */
.card { margin-top:20px; font-size:8vw; font-weight:bold; cursor:pointer; user-select:none; }

/* SUBTEXT */
.sub { font-size:24px; margin-top:20px; color:#00ffcc; }
#romanization, #meaning {
    font-weight:bold;
    padding:10px 15px;
    border-radius:10px;
    display:inline-block;
}
#romanization { color:#ffcc00; border:2px solid #ffcc00; background:#1a1a1a; }
#meaning { color:#00ffcc; border:2px solid #00ffcc; background:#1a1a1a; font-size:5vw; }

/* HIDDEN */
.hidden { display:none; }
.error { color:#ff4d4d; margin-top:15px; }

/* TAP INFO */
#tapInfo { cursor:pointer; font-size:10px; color:#0ff; margin-top:15px; }

/* RESPONSIVE */
@media (max-width:480px){
    .flex-center { flex-direction:column; gap:8px; }
    .card { font-size:12vw; }
    #meaning { font-size:6vw; }
    #romanization { font-size:6vw; }
}
</style>
</head>
<body>
<div class="container">
<h1>Korean EPS Vocabulary Mastering</h1>

<!-- MODE MENU -->
<div id="modeMenu">
<h2>Select Mode</h2>
<button class="menu-btn" onclick="setMode(1)">1️⃣ Hangul → Reveal</button>
<button class="menu-btn" onclick="setMode(2)">2️⃣ Hangul + Reveal Auto</button>
<button class="menu-btn" onclick="setMode(3)">3️⃣ Hangul + Meaning (No Romanization)</button>
</div>

<!-- CATEGORY MENU -->
<div id="categoryMenu" class="hidden">
<h2>Select Category</h2>
<div id="categories"></div>
<div id="errorMsg" class="error"></div>
<button class="back-btn" onclick="backToMode()">⬅️ Back to Mode</button>
</div>

<!-- FLASHCARD AREA -->
<div id="flashcard" class="hidden">
<h2 id="categoryTitle"></h2>

<!-- Back + Random toggle -->
<div class="flex-center">
  <button class="back-btn" onclick="backToMode()">⬅️ Back to Mode</button>
  <label style="margin:0; cursor:pointer;">
    <input type="checkbox" id="randomToggle" /> Random Order
  </label>
</div>

<div class="card" id="hangul"></div>
<div class="sub hidden" id="romanization"></div>
<div class="sub hidden" id="meaning"></div>
<div id="tapInfo" class="sub">Tap the word to reveal</div>
<br>
<button onclick="nextWord()">Next</button>
</div>

<script>
let vocabData = {};
let currentCategory = "";
let currentIndex = 0;
let mode = 1;

// Fallback vocab
vocabData = {
  "Work":[
    { "hangul":"일","romanization":"il","meaning":"work" },
    { "hangul":"회사","romanization":"hoesa","meaning":"company" }
  ],
  "Food":[
    { "hangul":"밥","romanization":"bap","meaning":"rice / meal" },
    { "hangul":"물","romanization":"mul","meaning":"water" }
  ]
};

// Fetch vocab.json
fetch('./vocab.json?timestamp='+new Date().getTime())
  .then(res => res.json())
  .then(data => { vocabData = data; console.log("Loaded vocab.json", vocabData); })
  .catch(err => { console.log("Using fallback data", err); });

// MODE SELECTION
function setMode(selectedMode){
    mode = selectedMode;
    document.getElementById('modeMenu').classList.add('hidden');
    document.getElementById('categoryMenu').classList.remove('hidden');
    loadCategories();
}
function backToMode(){
    document.getElementById('flashcard').classList.add('hidden');
    document.getElementById('categoryMenu').classList.add('hidden');
    document.getElementById('modeMenu').classList.remove('hidden');
}

// LOAD CATEGORIES
function loadCategories(){
    let catDiv = document.getElementById('categories');
    let errorDiv = document.getElementById('errorMsg');
    catDiv.innerHTML = "";
    errorDiv.innerText = "";

    if(Object.keys(vocabData).length===0){
        errorDiv.innerText="No categories found. Check vocab.json file.";
        return;
    }

    for(let category in vocabData){
        let btn = document.createElement('button');
        btn.className='category-btn';
        btn.innerText=category;
        btn.onclick=()=>selectCategory(category);
        catDiv.appendChild(btn);
    }
}

// SELECT CATEGORY
function selectCategory(category){
    currentCategory = category;
    currentIndex = 0;
    document.getElementById('categoryMenu').classList.add('hidden');
    document.getElementById('flashcard').classList.remove('hidden');
    document.getElementById('categoryTitle').innerText = category;
    showWord();
}

// SHOW WORD
function showWord(){
    let word = vocabData[currentCategory][currentIndex];

    document.getElementById('hangul').innerText = word.hangul;
    document.getElementById('romanization').innerText = `(${word.romanization})`; // ✅ parentheses
    document.getElementById('meaning').innerText = word.meaning;

    // Hide all first
    document.getElementById('romanization').classList.add('hidden');
    document.getElementById('meaning').classList.add('hidden');
    document.getElementById('tapInfo').style.display='none';

    if(mode===1){ document.getElementById('tapInfo').style.display='block'; }
    else if(mode===2){ reveal(); }
    else if(mode===3){ 
        document.getElementById('meaning').classList.remove('hidden');
        document.getElementById('romanization').classList.add('hidden');
    }
}

// REVEAL
function reveal(){
    if(mode===1 || mode===2){
        document.getElementById('romanization').classList.remove('hidden');
        document.getElementById('meaning').classList.remove('hidden');
        document.getElementById('tapInfo').style.display='none';
    }
}

// NEXT WORD (random or sequential)
function nextWord(){
    const words = vocabData[currentCategory];
    const randomToggle = document.getElementById('randomToggle');

    if(randomToggle.checked){
        let randIndex;
        do { randIndex = Math.floor(Math.random() * words.length); } 
        while(words.length>1 && randIndex===currentIndex);
        currentIndex = randIndex;
    } else {
        currentIndex++;
        if(currentIndex >= words.length) currentIndex=0;
    }

    showWord();
}

// SPACEBAR REVEAL
document.addEventListener('keydown', function(e){
    if(e.code==='Space' && mode===1){
        e.preventDefault();
        reveal();
    }
});

// TAP ON CARD TO REVEAL
document.getElementById('hangul').addEventListener('click', function(){
    if(mode===1) reveal();
});
</script>
</body>
</html>
