<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Korean EPS Vocabulary Mastering</title>
  
<style>
body { font-family: Arial, sans-serif; background:#111; color:#fff; text-align:center; }
.container { max-width:800px; margin:auto; padding:20px; }
button { padding:10px 20px; margin:5px; border:none; border-radius:8px; cursor:pointer; }
.menu-btn { background:#1f1f1f; color:#fff; }
.category-btn { background:#2d2d2d; color:#fff; }
.card { margin-top:40px; font-size:48px; font-weight:bold; cursor:pointer; user-select:none; }
.sub { font-size:24px; margin-top:20px; color:#00ffcc; }
.hidden { display:none; }
.error { color:#ff4d4d; margin-top:15px; }
.back-btn { background:#333; color:#fff; }
#tapInfo { cursor:pointer; font-size:10px; color:#0ff; margin-top:15px; }
label { cursor:pointer; }
</style>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
<h1>Korean EPS Vocabulary Mastering</h1>

<!-- MODE MENU -->
<div id="modeMenu">
<h2>Select Mode</h2>
<button class="menu-btn" onclick="setMode(1)">1Ô∏è‚É£ Hangul ‚Üí Reveal</button>
<button class="menu-btn" onclick="setMode(2)">2Ô∏è‚É£ Hangul + Reveal Auto</button>
<button class="menu-btn" onclick="setMode(3)">3Ô∏è‚É£ Hangul + Meaning (No Romanization)</button>
</div>

<!-- CATEGORY MENU -->
<div id="categoryMenu" class="hidden">
<h2>Select Category</h2>
<div id="categories"></div>
<div id="errorMsg" class="error"></div>
<button class="back-btn" onclick="backToMode()">‚¨ÖÔ∏è Back to Mode</button>
</div>

<!-- FLASHCARD AREA -->
<div id="flashcard" class="hidden">
<h2 id="categoryTitle"></h2>
  
<div style="display:flex; justify-content:center; align-items:center; gap:10px; margin:10px 0;">
  <button class="back-btn" onclick="backToMode()">‚¨ÖÔ∏è Back to Mode</button>
  <label style="margin:0; cursor:pointer;">
    <input type="checkbox" id="randomToggle" /> Random Order
  </label>
</div>


<div class="card" id="hangul"></div>
<div class="sub hidden" id="romanization"></div>
<div class="sub hidden" id="meaning" style="font-size:32px; font-weight:bold;"></div>
<div id="tapInfo" class="sub">Tap the word to reveal</div>
<br>
<button onclick="nextWord()">Next</button>
  <button class="report-btn" onclick="openReport()">‚ö† Report</button>

</div>
</div>

<script>
let vocabData = {};
let currentCategory = "";
let currentIndex = 0;
let mode = 1;
const randomToggle = document.getElementById('randomToggle');

// Fallback data
vocabData = {
  "Work": [
    { "hangul": "Ïùº", "romanization": "il", "meaning": "work" },
    { "hangul": "ÌöåÏÇ¨", "romanization": "hoesa", "meaning": "company" },
    { "hangul": "ÏßÅÏû•", "romanization": "jikjang", "meaning": "workplace" },
    { "hangul": "ÏÇ¨Ïû•", "romanization": "sajang", "meaning": "boss" },
    { "hangul": "ÏßÅÏõê", "romanization": "jigwon", "meaning": "employee" }
  ],
  "Food": [
    { "hangul": "Î∞•", "romanization": "bap", "meaning": "rice / meal" },
    { "hangul": "Î¨º", "romanization": "mul", "meaning": "water" },
    { "hangul": "ÍπÄÏπò", "romanization": "gimchi", "meaning": "kimchi" },
    { "hangul": "Íµ≠", "romanization": "guk", "meaning": "soup" }
  ],
  "Animals": [
    { "hangul": "Í∞ú", "romanization": "gae", "meaning": "dog" },
    { "hangul": "Í≥†ÏñëÏù¥", "romanization": "goyangi", "meaning": "cat" },
    { "hangul": "ÏÉà", "romanization": "sae", "meaning": "bird" }
  ]
};

// Load vocab.json if available
fetch('./vocab.json?timestamp=' + new Date().getTime())
  .then(res => res.json())
  .then(data => { vocabData = data; console.log("Loaded vocab.json", vocabData); })
  .catch(err => { console.log("Using fallback data", err); });

function setMode(selectedMode){
    mode = selectedMode;
    document.getElementById('modeMenu').classList.add('hidden');
    document.getElementById('categoryMenu').classList.remove('hidden');
    loadCategories();
}

function backToMode(){
    document.getElementById('flashcard').classList.add('hidden');
    document.getElementById('categoryMenu').classList.add('hidden');
    document.getElementById('modeMenu').classList.remove('hidden');
}

function loadCategories(){
    let catDiv = document.getElementById('categories');
    let errorDiv = document.getElementById('errorMsg');
    catDiv.innerHTML = "";
    errorDiv.innerText = "";

    if(Object.keys(vocabData).length === 0){
        errorDiv.innerText = "No categories found. Check vocab.json file.";
        return;
    }

    for(let category in vocabData){
        let btn = document.createElement('button');
        btn.className = 'category-btn';
        btn.innerText = category;
        btn.onclick = () => selectCategory(category);
        catDiv.appendChild(btn);
    }
}

function selectCategory(category){
    currentCategory = category;
    currentIndex = 0;
    document.getElementById('categoryMenu').classList.add('hidden');
    document.getElementById('flashcard').classList.remove('hidden');
    document.getElementById('categoryTitle').innerText = category;
    showWord();
}

function showWord(){
    const words = vocabData[currentCategory];
    if(!words || words.length === 0) return;
    const word = words[currentIndex];

    document.getElementById('hangul').innerText = word.hangul;
    document.getElementById('romanization').innerText = `(${word.romanization})`; // ‚úÖ add parentheses
    document.getElementById('meaning').innerText = word.meaning;

    // Hide all first
    document.getElementById('romanization').classList.add('hidden');
    document.getElementById('meaning').classList.add('hidden');
    document.getElementById('tapInfo').style.display = 'none';

    // Mode behaviors
    if(mode === 1){
        document.getElementById('tapInfo').style.display = 'block';
    }
    else if(mode === 2){
        reveal();
    }
    else if(mode === 3){
        document.getElementById('meaning').classList.remove('hidden');
        document.getElementById('romanization').classList.add('hidden');
    }
}

function reveal(){
    if(mode === 1 || mode === 2){
        document.getElementById('romanization').classList.remove('hidden');
        document.getElementById('meaning').classList.remove('hidden');
        document.getElementById('tapInfo').style.display = 'none';
    }
}

function nextWord(){
    const words = vocabData[currentCategory];
    if(!words || words.length === 0) return;

    if(randomToggle.checked){
        let randIndex;
        do {
            randIndex = Math.floor(Math.random() * words.length);
        } while(words.length > 1 && randIndex === currentIndex);
        currentIndex = randIndex;
    } else {
        currentIndex++;
        if(currentIndex >= words.length) currentIndex = 0;
    }

    showWord();
}

// SPACEBAR REVEAL
document.addEventListener('keydown', function(e){
    if(e.code === 'Space' && mode === 1){
        e.preventDefault();
        reveal();
    }
});

// TAP ON CARD TO REVEAL
document.getElementById('hangul').addEventListener('click', function(){
    if(mode === 1){
        reveal();
    }
});
</script>
  <div id="reportModal" class="report-overlay hidden">
  <div class="report-box">
    <div class="report-header">
      <h3>Report Correction</h3>
      <span onclick="closeReport()" class="close-btn">‚úï</span>
    </div>

    <textarea id="reportText" placeholder="Describe the grammar issue or correction..."></textarea>

    <button id="sendReportBtn" onclick="sendReport()">Send Report</button>

    <div id="reportStatus" class="status-msg"></div>
  </div>
</div>
  <script>
const webhookURL = "https://discord.com/api/webhooks/1477337691950420160/vmF4-lTK1_wfxxyXlOCKgEk84HUc_kh2XkHdHpi0ENpRlgihGgVcGJeQsSx-5EnDkApd";
let lastReportTime = 0;
const cooldown = 5000; // 5 seconds

function openReport() {
  document.getElementById("reportModal").classList.remove("hidden");
}

function closeReport() {
  document.getElementById("reportModal").classList.add("hidden");
  document.getElementById("reportText").value = "";
  document.getElementById("reportStatus").innerText = "";
}

async function sendReport() {
  const now = Date.now();

  if (now - lastReportTime < cooldown) {
    document.getElementById("reportStatus").innerText = "‚è≥ Please wait before sending again.";
    return;
  }

  const feedback = document.getElementById("reportText").value.trim();
  if (!feedback) {
    document.getElementById("reportStatus").innerText = "‚ö† Please enter feedback.";
    return;
  }

  const word = document.getElementById("hangul")?.innerText || "N/A";
  const roman = document.getElementById("romanization")?.innerText || "Hidden";
  const meaning = document.getElementById("meaning")?.innerText || "Hidden";

  const category = window.currentCategory || "Default";
  const mode = window.currentMode || "Flashcard";

  const payload = {
    embeds: [{
      title: "üìò Flashcard Report",
      color: 15158332,
      fields: [
        { name: "Word", value: word, inline: true },
        { name: "Romanization", value: roman, inline: true },
        { name: "Meaning", value: meaning, inline: false },
        { name: "Category", value: category, inline: true },
        { name: "Mode", value: mode, inline: true },
        { name: "Correction", value: feedback, inline: false }
      ],
      footer: {
        text: "Time: " + new Date().toLocaleString()
      }
    }]
  };

  try {
    const btn = document.getElementById("sendReportBtn");
    btn.disabled = true;

    await fetch(webhookURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    lastReportTime = now;

    document.getElementById("reportStatus").innerText = "‚úÖ Report sent successfully!";
    setTimeout(closeReport, 1500);

  } catch (error) {
    document.getElementById("reportStatus").innerText = "‚ùå Failed to send report.";
  } finally {
    document.getElementById("sendReportBtn").disabled = false;
  }
}
</script>
  
</body>
</html>
